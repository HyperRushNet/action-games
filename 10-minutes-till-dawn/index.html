<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title class="cloak">10 Minutes Till Dawn | MacVG</title>
  <link class="favicon" rel="shortcut icon" href="/logo.png" />
  <span id="macvgmacvg" name="game4"></span>
  <script src="/macvg/cloaker.js"></script>
  <script src="Build/UnityLoader.js"></script>
  <script src="/js/main.js"></script>

  <style>
    html, body {
      background: #000;
      width: 100%;
      height: 100%;
      overflow: hidden;
      padding: 0;
      margin: 0;
    }

    #gameContainer {
      background: transparent !important;
      position: absolute;
    }

    #gameContainer canvas {
      position: absolute;
      outline: none;
    }

    #gameContainer[data-pixelated="true"] canvas {
      image-rendering: pixelated;
    }

    #virtualKeyboard {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 230px;
      height: 230px;
      user-select: none;
      z-index: 1000;
      display: grid;
      grid-template-columns: 70px 70px 70px;
      grid-template-rows: 70px 70px 70px;
      gap: 10px;
      touch-action: none;
    }

    #virtualKeyboard button {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid #fff;
      border-radius: 5px;
      font-size: 28px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      outline: none;
    }

    #virtualKeyboard button:active {
      background: rgba(255, 255, 255, 0.5);
    }

    #virtualKeyboard button[data-key="KeyW"] {
      grid-column: 2;
      grid-row: 1;
    }

    #virtualKeyboard button[data-key="KeyA"] {
      grid-column: 1;
      grid-row: 2;
    }

    #virtualKeyboard button[data-key="KeyS"] {
      grid-column: 2;
      grid-row: 2;
    }

    #virtualKeyboard button[data-key="KeyD"] {
      grid-column: 3;
      grid-row: 2;
    }
  </style>
</head>

<body onload="onResize();">
  <div id="gameContainer" data-pixelated="true"></div>

  <!-- Virtueel WASD toetsenbord -->
  <div id="virtualKeyboard">
    <button data-key="KeyW">W</button>
    <button data-key="KeyA">A</button>
    <button data-key="KeyS">S</button>
    <button data-key="KeyD">D</button>
  </div>

  <script>
    var gameInstance = UnityLoader.instantiate("gameContainer", "Build/10MinutesTillDawnWebGL.json");
    var scaleToFit = true;

    function onResize() {
      if (!gameInstance || !gameInstance.Module || !gameInstance.Module.canvas) return;

      var canvas = gameInstance.Module.canvas;
      var container = gameInstance.container;
      var w, h;

      if (scaleToFit) {
        w = window.innerWidth;
        h = window.innerHeight;
        var r = 675 / 1200;

        if (w * r > h) w = Math.min(w, Math.ceil(h / r));
        h = Math.floor(w * r);
      } else {
        w = 1200;
        h = 675;
      }

      container.style.width = canvas.style.width = w + "px";
      container.style.height = canvas.style.height = h + "px";
      container.style.top = Math.floor((window.innerHeight - h) / 2) + "px";
      container.style.left = Math.floor((window.innerWidth - w) / 2) + "px";
    }

    window.addEventListener("resize", onResize);

    // Simuleer muisklik via touch
    function simulateMouseEvent(event, simulatedType) {
      if (event.touches.length > 0) {
        var touch = event.touches[0];
        var simulatedEvent = new MouseEvent(simulatedType, {
          bubbles: true,
          cancelable: true,
          view: window,
          detail: 1,
          screenX: touch.screenX,
          screenY: touch.screenY,
          clientX: touch.clientX,
          clientY: touch.clientY,
          button: 0,
          buttons: 1
        });

        window.dispatchEvent(simulatedEvent);
      }
    }

    var canvas = null;

    var waitForCanvas = setInterval(() => {
      if (gameInstance && gameInstance.Module && gameInstance.Module.canvas) {
        canvas = gameInstance.Module.canvas;

        // Geef canvas focus voor toetsenbordinput
        canvas.tabIndex = 1;
        canvas.focus();

        // Touch events â†’ muis
        canvas.addEventListener("touchstart", function(e) {
          simulateMouseEvent(e, "mousedown");
          e.preventDefault();
        }, false);

        canvas.addEventListener("touchmove", function(e) {
          simulateMouseEvent(e, "mousemove");
          e.preventDefault();
        }, false);

        canvas.addEventListener("touchend", function(e) {
          simulateMouseEvent(e, "mouseup");
          e.preventDefault();
        }, false);

        // WASD toetsen
        window.addEventListener("
